<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>

<body>

    <input type="text">
    <button style="padding:10px"></button>
    <p></p>
    <script>
        var input = document.querySelector("input");
        var btn = document.querySelector("button");
        var p = document.querySelector("p");

        /**
        I = 1
        V = 5
        X = 10
        L = 50
        C = 100
        D = 500
        M = 1000
        */

        var i, v, x, l, c, d, m;

        var nombres = [];
        var resultat;
        var key;
        /*
        La fonction "chiffresRomains" permet de convertir les chiffres romains en chiffres arabes.
        */
        function chiffresRomains() {
            //je recupère la valeur de l'input.
            var valeur = input.value;
            /*
            En chiffres romains, chaque chiffre/nombre est représenté par une lettre (sans blague...).
            */
            for (var j = 0; j < valeur.length; j++) {
                switch (valeur[j]) {
                case "i":
                case "I":
                    i = 1;
                    nombres.push(i);
                    break;
                case "v":
                case "V":
                    v = 5;
                    nombres.push(v);
                    break;
                case "x":
                case "X":
                    x = 10;
                    nombres.push(x);
                    break;
                case "l":
                case "L":
                    l = 50;
                    nombres.push(l);
                    break;
                case "c":
                case "C":
                    c = 100;
                    nombres.push(c);
                    break;
                case "d":
                case "D":
                    d = 500;
                    nombres.push(d);
                    break;
                case "m":
                case "M":
                    m = 1000;
                    nombres.push(m);
                    break;
                default:
                    /*
                    Si un chiffre non romain est écrit, on push dans le tableau au hasard un nombre erreur
                    (01019) pour sortir une erreur.
                    */
                    nombres.push(01019);
                    break;
                }
            }
        }

        function caracteresNonAcceptes() {
            var valeur = input.value;
            var str = "CDILMVXcdilmvx";
            var stringSplit = str.split("");
            for (i = 0; i < valeur.length; i++) {
                if (
                    valeur[i] !== "c" &&
                    valeur[i] !== "C" &&
                    valeur[i] !== "d" &&
                    valeur[i] !== "D" &&
                    valeur[i] !== "i" &&
                    valeur[i] !== "I" &&
                    valeur[i] !== "l" &&
                    valeur[i] !== "L" &&
                    valeur[i] !== "m" &&
                    valeur[i] !== "M" &&
                    valeur[i] !== "v" &&
                    valeur[i] !== "V" &&
                    valeur[i] !== "x" &&
                    valeur[i] !== "X" &&
                    valeur[i] !== " "
                ) {
                    p.textContent = "'" + valeur[i] + "' n'est pas un chiffre romain !";
                } else if (valeur[i] == " ") {
                    p.textContent = "Assurez-vous de ne pas mettre d'espace !";
                }
            }
            if (valeur.length == 0) {
                p.textContent = "";
            }
        }

        function calcul() {
            //je récupère le tableau qui contient les chiffres romains écrits dans l'input.
            chiffresRomains();
            //je push un 0 à la fin du tableau "nombre", il nous servira à arrêter la boucle.
            nombres.push(0);
            //enfin, je convertis tous les chiffres et/ou nombres en entier.
            for (i = 0; i < nombres.length; i++) {
                nombres[i] = parseInt(nombres[i]);
            }
            //le résulat prend la première valeur du tableau.
            resultat = nombres[0];

            //le calcul commence !
            for (i = 0; i < nombres.length; i++) {
                /*
                En chiffres romains, deux chiffres décroissants sont additionner et deux chiffres croissants sont soustraits
                donc, si i est plus petit que le chiffre avant ET après lui...
                */
                if (nombres[i] < nombres[i + 1] && nombres[i] < nombres[i - 1]) {
                    //résultat prend la valeur qui est avant notre i.
                    resultat = nombres[i - 1];
                    //(pour voir le calcul)...
                    console.log(resultat + " + (" + (relative(nombres[i]) + " + " + nombres[i + 1] + ")"));
                    //la fonction "relative" rend un chiffre/nombre positif négatif.
                    resultat = resultat + (relative(nombres[i]) + nombres[i + 1]);
                    //voir le résultat
                    console.log(resultat);
                    /*
                    Si i est seulement plus petit que le i qui le suit...
                    */
                } else if (nombres[i] < nombres[i + 1]) {
                    //voir le calcul.
                    console.log(relative(resultat) + " + " + nombres[i + 1]);
                    //calcul...
                    resultat = relative(resultat) + nombres[i + 1];
                    //voir le résultat.
                    console.log(resultat);
                    /*
                    Si i est supérieur au i qui le suit...
                    */
                } else if (nombres[i] == 01019) {
                    //si 01019, le nombre erreur est détecté, la boucle s'arrête est un message d'erreur apparaît.
                    p.textContent = "Erreur ! Assurez-vous d'avoir entré que des chiffres romains et pas d'espaces.";
                    nombres = [];
                    break;
                } else {
                    //voir le calcul.
                    console.log(resultat + " + " + nombres[i + 1]);
                    //calcul...
                    resultat += nombres[i + 1];
                    //voir le résultat.
                    console.log(resultat);
                }
                /*
                Enfin si l'avant dernier i rencontre le dernier i (0), 
                ils s'additionnent et la boucle s'arrête.
                */
                if (nombres[i + 1] == 0) {
                    p.textContent = resultat;
                    nombres = [];
                    break;
                }
                /*
                Cas si une lettre entrée n'est pas un chiffre romain
                */
            }
        }


        //la fonction relative qui rend négatif un chiffre/nombre positif.
        function relative(a) {
            a = parseInt(a);
            return a - (a * 2);
        }

        btn.addEventListener("click", calcul);
        input.addEventListener("keyup", caracteresNonAcceptes);
    </script>

</body>

</html>